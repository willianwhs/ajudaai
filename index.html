<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AJUDAAI ‚Äî Profissionais perto de voc√™</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
:root{
--amarelo:#FFC107;
--azul:#1E3A8A;
--cinza:#f4f6f8;
--escuro:#222;
--whatsapp:#25D366;
}

*{box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}

body{margin:0;background:var(--cinza);color:var(--escuro)}

header{
background:#fff;
padding:26px 16px;
text-align:center;
border-bottom:3px solid var(--amarelo)
}

h1{margin:0;font-size:34px;font-weight:800}
.logo1{color:var(--azul)}
.logo2{color:var(--amarelo)}

.btn{
margin-top:14px;
background:var(--azul);
color:#fff;
border:none;
padding:12px 18px;
border-radius:10px;
font-weight:bold;
cursor:pointer
}

#mapa{
height:360px;
width:100%;
max-width:1100px;
margin:20px auto;
border-radius:14px;
box-shadow:0 6px 18px rgba(0,0,0,.12)
}

.cards{
max-width:1100px;
margin:auto;
padding:20px;
display:grid;
grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
gap:20px
}

.card{
background:#fff;
border-radius:14px;
padding:20px;
text-align:center;
box-shadow:0 6px 18px rgba(0,0,0,.08);
position:relative
}

.selo{
position:absolute;
top:10px;
right:10px;
background:var(--azul);
color:#fff;
padding:4px 10px;
border-radius:20px;
font-size:12px;
font-weight:bold
}

.distancia{
margin-top:6px;
font-weight:bold;
color:var(--azul)
}

.botao{
display:block;
margin-top:8px;
padding:10px;
border-radius:8px;
text-decoration:none;
font-weight:bold
}

.whatsapp{background:var(--whatsapp);color:#fff}
.avaliar{background:var(--azul);color:#fff}
</style>
</head>

<body>

<header>
<h1><span class="logo1">AJUDA</span><span class="logo2">AI</span></h1>
<p>Conectando voc√™ a profissionais de confian√ßa</p>
<button class="btn" onclick="ativarLocalizacao()">üìç Perto de mim</button>
</header>

<div id="mapa"></div>

<div class="cards" id="lista"></div>

<script>
const URL_JSON="https://raw.githubusercontent.com/willianwhs/ajudaai/main/prestadores.json";

let prestadores=[];
let mapa;
let marcadores=[];

fetch(URL_JSON)
.then(r=>r.json())
.then(d=>{
prestadores=d;
renderPrestadores(prestadores);
});

function calcularDistancia(lat1,lng1,lat2,lng2){
const R=6371;
const dLat=(lat2-lat1)*Math.PI/180;
const dLng=(lng2-lng1)*Math.PI/180;
const a=Math.sin(dLat/2)**2+
Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*
Math.sin(dLng/2)**2;
return R*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)));
}

/* üèÜ RANKING INVIS√çVEL */
function calcularScore(p){
let score=0;

if(p.distancia!=null){
score += Math.max(0,100-p.distancia)*0.5;
}

if(p.media){
score += (p.media*20)*0.3;
}

if(p.verificado){
score += 10;
}

return score;
}

function iniciarMapa(lat,lng){
if(mapa) return;

mapa=L.map("mapa").setView([lat,lng],13);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{
attribution:"¬© OpenStreetMap"
}).addTo(mapa);

L.marker([lat,lng])
.addTo(mapa)
.bindPopup("üìç Voc√™ est√° aqui")
.openPopup();
}

function renderizarPinos(lista){
marcadores.forEach(m=>mapa.removeLayer(m));
marcadores=[];

lista.forEach(p=>{
if(p.lat && p.lng){
const m=L.marker([p.lat,p.lng])
.addTo(mapa)
.bindPopup(`<b>${p.nome}</b><br>${p.servico}<br>${p.cidade}`);
marcadores.push(m);
}
});
}

function ativarLocalizacao(){
navigator.geolocation.getCurrentPosition(pos=>{
const userLat=pos.coords.latitude;
const userLng=pos.coords.longitude;

iniciarMapa(userLat,userLng);

prestadores.forEach(p=>{
if(p.lat && p.lng){
p.distancia=calcularDistancia(userLat,userLng,p.lat,p.lng);
}else{
p.distancia=null;
}
p.score = calcularScore(p);
});

/* üî• ORDENA√á√ÉO PREMIUM (INVIS√çVEL) */
prestadores.sort((a,b)=>(b.score||0)-(a.score||0));

renderPrestadores(prestadores);
renderizarPinos(prestadores);
});
}

function renderPrestadores(lista){
const c=document.getElementById("lista");
c.innerHTML="";

lista.forEach(p=>{
const estrelas=p.media?"‚≠ê".repeat(Math.round(p.media)):"Sem avalia√ß√µes";
const dist=p.distancia!=null?`üìç ${p.distancia.toFixed(1)} km`:"";

c.innerHTML+=`
<div class="card">
${p.verificado?'<div class="selo">‚úî Verificado</div>':''}
<h3>${p.nome}</h3>
<div>${p.servico}</div>
<div>${p.cidade}</div>
<div class="distancia">${dist}</div>
<div>${estrelas}</div>
<a class="botao whatsapp" href="https://wa.me/55${p.whatsapp}" target="_blank">WhatsApp</a>
<a class="botao avaliar" href="#" target="_blank">Avaliar</a>
</div>
`;
});
}
</script>

</body>
</html>
