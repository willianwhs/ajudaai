<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AJUDAAI</title>

<style>
body{font-family:Arial;margin:0;background:#f4f6f8}
header{text-align:center;padding:20px;background:#fff;border-bottom:3px solid #FFC107}
.cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:20px;padding:20px}
.card{background:#fff;padding:20px;border-radius:14px;text-align:center}
.botao{display:block;margin-top:10px;padding:10px;background:#25D366;color:#fff;text-decoration:none;border-radius:8px}
</style>
</head>

<body>

<header>
<h1><span style="color:#1E3A8A">AJUDA</span><span style="color:#FFC107">AI</span></h1>
<button onclick="ativarLocalizacao()">üìç Perto de mim</button>
</header>

<div class="cards" id="lista"></div>

<script>

const URL_JSON="https://raw.githubusercontent.com/willianwhs/ajudaai/main/prestadores.json";
let dados=[];

fetch(URL_JSON).then(r=>r.json()).then(d=>{
dados=d;
render(dados);
});

function calcularDistancia(lat1,lng1,lat2,lng2){
const R=6371;
const dLat=(lat2-lat1)*Math.PI/180;
const dLng=(lng2-lng1)*Math.PI/180;
const a=Math.sin(dLat/2)**2+
Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*
Math.sin(dLng/2)**2;
return R*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)));
}

function ativarLocalizacao(){
navigator.geolocation.getCurrentPosition(pos=>{
const userLat=pos.coords.latitude;
const userLng=pos.coords.longitude;

dados.forEach(p=>{
if(p.lat && p.lng){
p.distancia=calcularDistancia(userLat,userLng,p.lat,p.lng);
}
});

dados.sort((a,b)=>(a.distancia||999)-(b.distancia||999));
render(dados);
});
}

function render(lista){
const c=document.getElementById("lista");
c.innerHTML="";
lista.forEach(p=>{
const dist=p.distancia?`üìç ${p.distancia.toFixed(1)} km`:"";
c.innerHTML+=`
<div class="card">
<h3>${p.nome}</h3>
<div>${p.servico}</div>
<div>${p.cidade}</div>
<div>${dist}</div>
<a class="botao" href="https://wa.me/55${p.whatsapp}" target="_blank">WhatsApp</a>
</div>`;
});
}

</script>

</body>
</html>
