<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AJUDA AI | Conectando Solu√ß√µes e Valorizando o Trabalho Local</title>
    
    <meta name="description" content="O Ajuda A√≠ conecta prestadores de servi√ßos locais a clientes de forma direta e segura. Encontre eletricistas, encanadores, diaristas e muito mais.">
    <meta property="og:title" content="AJUDA AI | Sua ajuda chegou. Onde voc√™ estiver.">
    <meta property="og:description" content="A maior vitrine de profissionais locais do Brasil.">
    <meta name="theme-color" content="#050B14">

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --brand-dark: #050B14;
            --brand-blue: #0A1931;
            --brand-blue-light: #185ADB;
            --brand-yellow: #FFB400; 
            --text-main: #FFFFFF;
            --text-muted: #94A3B8;
            --border: rgba(255, 255, 255, 0.1);
            --card-bg: linear-gradient(145deg, #0A1931, #050B14);
        }

        /* Reset e Base */
        * { box-sizing: border-box; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); scroll-behavior: smooth; }
        body { margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; background: var(--brand-dark); color: var(--text-main); overflow-x: hidden; line-height: 1.5; }
        .container { max-width: 1200px; margin: auto; padding: 0 24px; }
        
        /* Utilit√°rios */
        .text-yellow { color: var(--brand-yellow); }
        .hidden { display: none; }

        /* --- PUBLICIDADE ADSENSE --- */
        .ads-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 30px 0;
            overflow: hidden;
            min-height: 100px;
        }
        .ads-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 8px; letter-spacing: 1px; }

        /* --- HEADER & NAV --- */
        header { 
            background: rgba(5, 11, 20, 0.9); backdrop-filter: blur(20px);
            border-bottom: 2px solid var(--brand-yellow);
            position: sticky; top: 0; z-index: 1000; padding: 14px 0;
        }
        .nav { display: flex; align-items: center; justify-content: space-between; }
        .logo-container { display: flex; align-items: center; gap: 10px; text-decoration: none; }
        .pin-icon { width: 32px; height: 32px; fill: var(--brand-yellow); filter: drop-shadow(0 0 5px rgba(255, 180, 0, 0.5)); }
        .logo-text { font-size: 24px; font-weight: 800; color: var(--brand-yellow); letter-spacing: -1px; }
        .logo-text span { color: white; }

        .nav-actions { display: flex; gap: 15px; align-items: center; }
        .nav-link-top { 
            color: white; text-decoration: none; font-weight: 700; font-size: 12px; 
            text-transform: uppercase; border: 1px solid var(--border); 
            padding: 10px 16px; border-radius: 12px; 
        }
        .nav-link-top:hover { background: rgba(255,255,255,0.05); border-color: var(--brand-yellow); }

        .menu-hamburger { display: none; cursor: pointer; flex-direction: column; gap: 6px; background: none; border: none; padding: 5px; }
        .menu-hamburger span { width: 28px; height: 3px; background: var(--brand-yellow); border-radius: 2px; }

        @media (max-width: 900px) {
            .menu-hamburger { display: flex; }
            .nav-actions { 
                display: none; position: absolute; top: 75px; right: 24px; 
                flex-direction: column; background: var(--brand-blue); 
                padding: 24px; border-radius: 24px; border: 1px solid var(--brand-yellow); 
                box-shadow: 0 20px 50px rgba(0,0,0,0.7); width: 250px;
            }
            .nav-actions.active { display: flex; }
            .nav-actions a, .nav-actions button { width: 100%; text-align: center; }
        }

        /* --- HERO SECTION --- */
        .hero { 
            padding: 100px 0 80px; text-align: center;
            background: radial-gradient(circle at top, #185ADB22, transparent);
            border-radius: 0 0 100px 100px;
        }
        .expansion-badge {
            background: linear-gradient(90deg, var(--brand-yellow), #FFD700);
            color: var(--brand-blue); padding: 8px 20px; font-size: 13px;
            font-weight: 800; border-radius: 50px; display: inline-block; 
            margin-bottom: 25px; text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(255, 180, 0, 0.2);
        }
        .hero h1 { font-size: clamp(36px, 9vw, 68px); font-weight: 800; line-height: 1; margin-bottom: 24px; letter-spacing: -3px; }
        .hero p { font-size: 20px; color: var(--text-muted); max-width: 800px; margin: 0 auto 45px; }

        .btn-group { display: flex; gap: 18px; justify-content: center; flex-wrap: wrap; }
        .btn-mega { 
            padding: 22px 38px; border-radius: 24px; font-weight: 800; cursor: pointer; 
            border: none; font-size: 16px; text-transform: uppercase; 
            display: flex; align-items: center; gap: 12px; width: 100%; 
            max-width: 420px; justify-content: center;
        }
        @media (min-width: 768px) { .btn-mega { width: auto; } }
        
        .btn-yellow { background: var(--brand-yellow); color: var(--brand-blue); box-shadow: 0 12px 30px rgba(255, 180, 0, 0.3); }
        .btn-yellow:hover { transform: translateY(-3px); box-shadow: 0 15px 35px rgba(255, 180, 0, 0.4); }
        .btn-work { background: transparent; color: white; border: 2px solid var(--brand-yellow); }
        .btn-work:hover { background: var(--brand-yellow); color: var(--brand-blue); }

        /* --- MAPA & GPS --- */
        .map-section { padding: 40px 0; }
        .map-wrapper { position: relative; max-width: 1100px; margin: 0 auto; border-radius: 45px; overflow: hidden; border: 5px solid var(--brand-blue); box-shadow: 0 20px 40px rgba(0,0,0,0.4); }
        #map { height: 450px; width: 100%; z-index: 1; }
        .btn-near { 
            position: absolute; bottom: 25px; right: 25px; z-index: 500; 
            background: var(--brand-yellow); border: none; padding: 15px 25px; 
            border-radius: 50px; font-weight: 800; cursor: pointer; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            display: flex; align-items: center; gap: 8px;
        }

        /* --- BUSCA E FILTROS --- */
        .search-container { max-width: 700px; margin: 40px auto 10px; position: relative; }
        .search-input { 
            width: 100%; padding: 22px 30px 22px 65px; border-radius: 60px; 
            background: rgba(255,255,255,0.05); border: 2px solid var(--border); 
            color: white; font-size: 18px; outline: none; 
        }
        .search-input:focus { border-color: var(--brand-yellow); background: rgba(255,255,255,0.08); }
        .search-icon { position: absolute; left: 25px; top: 50%; transform: translateY(-50%); fill: var(--brand-yellow); width: 24px; }

        .filter-bar { display: flex; gap: 12px; overflow-x: auto; padding: 20px 0; scrollbar-width: none; justify-content: center; }
        .filter-tag { 
            background: rgba(255,255,255,0.03); border: 1px solid var(--border); 
            padding: 12px 24px; border-radius: 50px; color: white; 
            font-size: 14px; font-weight: 600; cursor: pointer; white-space: nowrap; 
        }
        .filter-tag.active { border-color: var(--brand-yellow); color: var(--brand-yellow); background: rgba(255, 180, 0, 0.1); }

        /* --- CARDS E GRIDS --- */
        .grid-layout { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; margin-top: 40px; }
        
        /* Card Prestador */
        .prestador-card { 
            background: var(--card-bg); border-radius: 35px; padding: 30px; 
            border: 1px solid var(--border); position: relative; 
            display: flex; flex-direction: column; gap: 15px;
        }
        .prestador-card:hover { border-color: var(--brand-yellow); transform: translateY(-5px); }
        .badge-premium { position: absolute; top: 15px; right: 15px; background: var(--brand-yellow); color: var(--brand-blue); font-size: 11px; font-weight: 900; padding: 5px 12px; border-radius: 8px; }
        .card-header { display: flex; align-items: center; gap: 15px; }
        .avatar { width: 60px; height: 60px; border-radius: 50%; background: var(--brand-blue-light); border: 2px solid var(--brand-yellow); display: flex; align-items: center; justify-content: center; font-size: 22px; font-weight: 800; }
        .stars { color: var(--brand-yellow); font-size: 14px; display: flex; gap: 3px; }

        /* Card Pedido */
        .job-card { 
            background: var(--brand-blue); border-radius: 35px; padding: 30px; 
            border: 1px solid var(--border); border-left: 5px solid var(--brand-yellow);
        }
        .job-card h3 { margin: 0 0 10px 0; font-size: 20px; }
        .job-card p { color: var(--text-muted); font-size: 15px; line-height: 1.6; margin-bottom: 20px; }

        /* --- COMO FUNCIONA --- */
        .steps-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; padding: 60px 0; }
        .step-item { background: rgba(255,255,255,0.02); padding: 40px; border-radius: 35px; border: 1px solid var(--border); text-align: center; }
        .step-icon { font-size: 45px; margin-bottom: 20px; display: block; }
        .step-item h3 { font-size: 22px; margin-bottom: 15px; }

        /* --- DEPOIMENTOS --- */
        .testimonial-card { background: rgba(255,255,255,0.02); padding: 35px; border-radius: 30px; border: 1px solid var(--border); }
        .testimonial-text { font-style: italic; font-size: 16px; margin-bottom: 20px; opacity: 0.9; }
        .author-box { display: flex; align-items: center; gap: 12px; }

        /* --- QUEM SOMOS --- */
        .about-box { 
            background: linear-gradient(135deg, #050B14 0%, #0A1931 100%); 
            padding: 80px 40px; border-radius: 60px; margin: 80px 0; 
            border: 1px solid var(--brand-yellow); text-align: center; 
        }
        .about-box h2 { font-size: 42px; margin-bottom: 25px; }
        .about-box p { font-size: 20px; max-width: 900px; margin: 0 auto; line-height: 1.8; }

        /* --- MODAIS --- */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(20px); display: none; align-items: center; justify-content: center; z-index: 9999; padding: 20px; }
        .modal-content { 
            background: var(--brand-blue); padding: 45px; border-radius: 45px; 
            width: 100%; max-width: 600px; border: 1px solid var(--border); 
            max-height: 90vh; overflow-y: auto; position: relative;
        }
        input, textarea, select { 
            width: 100%; padding: 18px 24px; border-radius: 20px; 
            background: rgba(255,255,255,0.05); border: 2px solid var(--border); 
            color: white; margin-top: 12px; outline: none; font-size: 16px;
        }
        input:focus, textarea:focus { border-color: var(--brand-yellow); }
        label { display: block; margin-top: 20px; font-weight: 600; font-size: 14px; color: var(--brand-yellow); }

        /* --- FOOTER --- */
        footer { padding: 80px 0 40px; background: #03070C; border-top: 1px solid var(--border); text-align: center; }
        .footer-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 40px; margin-bottom: 50px; text-align: left; }
        .footer-col h4 { color: var(--brand-yellow); margin-bottom: 20px; }
        .footer-col a { color: var(--text-muted); text-decoration: none; display: block; margin-bottom: 12px; font-size: 14px; }
        .footer-col a:hover { color: white; }

        /* Responsividade Fina */
        @media (max-width: 600px) {
            .hero { padding: 60px 0; }
            .modal-content { padding: 30px 20px; }
            .btn-near { bottom: 15px; right: 15px; padding: 12px 18px; font-size: 13px; }
        }
    </style>
</head>
<body>

<header>
    <div class="container nav">
        <a href="#" class="logo-container">
            <svg class="pin-icon" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
            <div class="logo-text">AJUDA<span>AI</span></div>
        </a>
        <div class="nav-actions" id="navActions">
            <a href="#" class="nav-link-top" onclick="closeMenu()">In√≠cio</a>
            <a href="#como-funciona" class="nav-link-top" onclick="closeMenu()">Como Funciona</a>
            <a href="#quem-somos" class="nav-link-top" onclick="closeMenu()">Quem Somos</a>
            <button onclick="openModal('modalPrestador'); closeMenu();" class="btn-yellow" style="padding:12px 20px; border-radius:12px; border:none; font-weight:800; cursor:pointer;">QUERO TRABALHAR</button>
        </div>
        <button class="menu-hamburger" onclick="toggleMenu()"><span></span><span></span><span></span></button>
    </div>
</header>

<section class="hero">
    <div class="container">
        <div class="expansion-badge">üáßüá∑ CONECTANDO O BRASIL DE PONTA A PONTA</div>
        <h1>Sua ajuda chegou.<br><span class="text-yellow">Onde voc√™ estiver.</span></h1>
        <p>A ponte que conecta o talento de profissionais locais √† necessidade de quem precisa. Contrata√ß√£o segura, direta e sem taxas abusivas.</p>
        <div class="btn-group">
            <button class="btn-mega btn-yellow" onclick="openModal('modalPedido')">üéØ PEDIR AJUDA AGORA</button>
            <button class="btn-mega btn-work" onclick="openModal('modalPrestador')">üöÄ CADASTRAR MEU SERVI√áO</button>
        </div>
        <div style="margin-top: 30px; font-size: 14px; font-weight: 700; color: var(--brand-yellow); text-transform: uppercase; letter-spacing: 1px;">
            Diaristas ‚Ä¢ Eletricistas ‚Ä¢ Pintores ‚Ä¢ Encanadores ‚Ä¢ E muito mais
        </div>
    </div>
</section>

<div class="container">
    
    <div class="ads-container">
        <div class="ads-label">Publicidade</div>
        <div style="width:100%; height:90px; background:rgba(255,255,255,0.02); border-radius:15px; display:flex; align-items:center; justify-content:center; border:1px dashed var(--border);">
            <span style="color:var(--text-muted); font-size:12px;">Espa√ßo para Google AdSense</span>
        </div>
    </div>

    <section class="map-section">
        <h2 style="text-align: center; margin-bottom: 30px;">Encontre suporte <span class="text-yellow">ao seu redor</span></h2>
        <div class="map-wrapper">
            <div id="map"></div>
            <button class="btn-near" onclick="getGPS()">üìç NEAR ME (USAR GPS)</button>
        </div>
    </section>

    <section id="vitrine" style="padding: 60px 0;">
        <h2 style="font-size: 32px; text-align: center; margin-bottom: 10px;">Profissionais em <span class="text-yellow" id="cidadeDestaque">sua Regi√£o</span></h2>
        <p style="text-align:center; color:var(--text-muted); margin-bottom: 40px;">Especialistas avaliados pela comunidade prontos para te atender.</p>
        <div class="grid-layout" id="vitrineGrid">
            </div>
    </section>

    <section id="como-funciona">
        <div class="steps-grid">
            <div class="step-item">
                <span class="step-icon">üìù</span>
                <h3>Poste seu Pedido</h3>
                <p>Diga o que voc√™ precisa, onde e quando. √â r√°pido e gratuito para quem busca ajuda.</p>
            </div>
            <div class="step-item">
                <span class="step-icon">üõ†Ô∏è</span>
                <h3>Receba Propostas</h3>
                <p>Profissionais qualificados da sua regi√£o entrar√£o em contato via WhatsApp para combinar os detalhes.</p>
            </div>
            <div class="step-item">
                <span class="step-icon">ü§ù</span>
                <h3>Negocie Direto</h3>
                <p>Sem intermedi√°rios. Voc√™ conversa, avalia o perfil e fecha o servi√ßo diretamente com o prestador.</p>
            </div>
        </div>
    </section>

    <section id="mural" style="padding: 60px 0;">
        <div class="search-container">
            <svg class="search-icon" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
            <input type="text" class="search-input" id="muralSearch" placeholder="O que voc√™ est√° procurando hoje?">
        </div>

        <div class="filter-bar">
            <div class="filter-tag active">Todos</div>
            <div class="filter-tag">üè† Casa</div>
            <div class="filter-tag">‚ö° T√©cnica</div>
            <div class="filter-tag">üßº Limpeza</div>
            <div class="filter-tag">üì¶ Fretes</div>
        </div>

        <h2 style="font-size: 32px; text-align: center; margin: 50px 0 20px;">Mural de <span class="text-yellow">Oportunidades</span></h2>
        <div class="grid-layout" id="muralGrid">
            </div>
    </section>

    <section id="quem-somos" class="about-box">
        <h2>O Cora√ß√£o do <span class="text-yellow">Ajuda A√≠</span></h2>
        <p>O Ajuda A√≠ nasceu da vontade de simplificar a vida de quem precisa de servi√ßos e valorizar quem faz o trabalho acontecer. Somos uma plataforma brasileira focada em <b>autonomia profissional</b>. <br><br> Aqui, o trabalhador √© seu pr√≥prio chefe e o cliente encontra agilidade com quem mora logo ali. Estamos em expans√£o nacional para garantir que ningu√©m fique sem ajuda, n√£o importa a cidade.</p>
    </section>

    <section style="padding: 40px 0;">
        <div class="grid-layout">
            <div class="testimonial-card">
                <p class="testimonial-text">"Encontrei um encanador em 10 minutos. Ele morava no quarteir√£o de tr√°s. O Ajuda A√≠ salvou meu domingo!"</p>
                <div class="author-box">
                    <div class="avatar">M</div>
                    <div><h5 style="margin:0">Marcos Oliveira</h5><small>Cliente em Curitiba</small></div>
                </div>
            </div>
            <div class="testimonial-card">
                <p class="testimonial-text">"Sou diarista e agora minha agenda est√° sempre cheia. N√£o pago comiss√£o pra ningu√©m, o dinheiro √© todo meu."</p>
                <div class="author-box">
                    <div class="avatar" style="background: #E91E63">S</div>
                    <div><h5 style="margin:0">Sandra Lima</h5><small>Diarista em Barueri</small></div>
                </div>
            </div>
        </div>
    </section>

</div>

<footer>
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col">
                <div class="logo-text">AJUDA<span>AI</span></div>
                <p style="color:var(--text-muted); font-size:14px; margin-top:15px;">Transformando a presta√ß√£o de servi√ßos no Brasil atrav√©s da tecnologia e proximidade.</p>
            </div>
            <div class="footer-col">
                <h4>Navega√ß√£o</h4>
                <a href="#">In√≠cio</a>
                <a href="#como-funciona">Como Funciona</a>
                <a href="#quem-somos">Quem Somos</a>
            </div>
            <div class="footer-col">
                <h4>Legal</h4>
                <a href="#" onclick="alert('Pol√≠tica de Privacidade em breve')">Privacidade</a>
                <a href="#" onclick="alert('Termos de Uso em breve')">Termos de Uso</a>
            </div>
        </div>
        <p style="font-size: 12px; color: rgba(255,255,255,0.2); border-top: 1px solid var(--border); padding-top: 30px;">
            ¬© 2026 AJUDA AI - CONEX√ÉO HUMANA, SEGURA E DIRETA. TODOS OS DIREITOS RESERVADOS.
        </p>
    </div>
</footer>

<div class="modal" id="modalPrestador">
    <div class="modal-content">
        <h2 style="margin-top:0">Seja um <span class="text-yellow">Parceiro</span></h2>
        <p style="color:var(--text-muted); font-size:14px;">Cadastre seu servi√ßo e seja encontrado por clientes na sua cidade.</p>
        <form onsubmit="registrarPrestador(event)">
            <label>NOME COMPLETO</label>
            <input type="text" id="pres_nome" placeholder="Ex: Jo√£o da Silva" required>
            
            <label>WHATSAPP (COM DDD)</label>
            <input type="tel" id="pres_whatsapp" class="mask-whatsapp" placeholder="(00) 0 0000-0000" maxlength="16" required>
            
            <label>SUA PROFISS√ÉO / ESPECIALIDADE</label>
            <input type="text" id="pres_servico" placeholder="Ex: Eletricista Residencial" required>
            
            <label>CIDADE DE ATUA√á√ÉO</label>
            <input type="text" id="pres_cidade" placeholder="Sua cidade" required>
            
            <label>FALE UM POUCO SOBRE SEU TRABALHO</label>
            <textarea id="pres_bio" rows="3" placeholder="Conte sua experi√™ncia..."></textarea>
            
            <button type="submit" id="btnSalvarPrestador" class="btn-mega btn-yellow" style="margin-top:30px; border-radius:20px;">CRIAR MEU PERFIL</button>
            <button type="button" onclick="closeModal('modalPrestador')" style="background:none; color:white; border:none; width:100%; margin-top:15px; cursor:pointer; font-weight:600;">VOLTAR</button>
        </form>
    </div>
</div>

<div class="modal" id="modalPedido">
    <div class="modal-content">
        <h2 style="margin-top:0">Postar <span class="text-yellow">Pedido</span></h2>
        <p style="color:var(--text-muted); font-size:14px;">Descreva o que voc√™ precisa e os prestadores te chamar√£o.</p>
        <form onsubmit="postarPedido(event)">
            <label>SEU NOME</label>
            <input type="text" id="ped_nome" placeholder="Como quer ser chamado?" required>
            
            <label>SEU WHATSAPP</label>
            <input type="tel" id="ped_whatsapp" class="mask-whatsapp" placeholder="(00) 0 0000-0000" maxlength="16" required>
            
            <label>O QUE VOC√ä PRECISA?</label>
            <input type="text" id="ped_titulo" placeholder="Ex: Pintura de 2 quartos" required>
            
            <label>LOCALIZA√á√ÉO (CIDADE)</label>
            <input type="text" id="ped_cidade" placeholder="Onde o servi√ßo ser√° feito?" required>
            
            <label>MAIS DETALHES (OPCIONAL)</label>
            <textarea id="ped_descricao" rows="3" placeholder="Ex: Preciso para o pr√≥ximo s√°bado de manh√£..."></textarea>
            
            <button type="submit" id="btnPostarPedido" class="btn-mega btn-yellow" style="margin-top:30px; border-radius:20px;">POSTAR NO MURAL</button>
            <button type="button" onclick="closeModal('modalPedido')" style="background:none; color:white; border:none; width:100%; margin-top:15px; cursor:pointer; font-weight:600;">CANCELAR</button>
        </form>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // --- CONFIGURA√á√ÉO DO SUPABASE (DADOS FORNECIDOS PELO USU√ÅRIO) ---
    const SUPABASE_URL = 'https://vhoiwkndxmmajwoskxdl.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZob2l3a25keG1tYWp3b3NreGRsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1ODA5NTcsImV4cCI6MjA4NzE1Njk1N30.ieQQz4158eWEaHkC5yMjMIIFg-FBabbwUz-vpXyo1c8';
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    let userLat = null;
    let userLng = null;
    let currentCity = "Brasil";

    // --- INICIALIZA√á√ÉO DO MAPA ---
    const map = L.map('map', { zoomControl: false }).setView([-23.55, -46.63], 12);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{z}/{x}/{y}{r}.png', {
        attribution: '¬© Ajuda A√≠'
    }).addTo(map);

    // √çcones Customizados
    const goldIcon = L.icon({
        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-gold.png',
        iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34]
    });

    // --- FUN√á√ïES DE GPS E GEOLOCALIZA√á√ÉO ---
    async function getGPS() {
        if (!navigator.geolocation) return alert("Seu navegador n√£o suporta GPS.");
        
        navigator.geolocation.getCurrentPosition(async (pos) => {
            userLat = pos.coords.latitude;
            userLng = pos.coords.longitude;
            map.flyTo([userLat, userLng], 15);
            L.marker([userLat, userLng]).addTo(map).bindPopup("Voc√™ est√° aqui!").openPopup();
            
            // Busca cidade via Nominatim (Reverse Geocoding)
            try {
                const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${userLat}&lon=${userLng}`);
                const data = await res.json();
                const city = data.address.city || data.address.town || data.address.village;
                if (city) {
                    currentCity = city;
                    document.getElementById('cidadeDestaque').innerText = city;
                    document.getElementById('pres_cidade').value = city;
                    document.getElementById('ped_cidade').value = city;
                    carregarVitrine(city);
                }
            } catch (e) { console.error("Erro ao buscar cidade", e); }
        });
    }

    // --- CARREGAR DADOS DO SUPABASE ---
    async function carregarVitrine(filtroCidade = "") {
        let query = _supabase.from('prestadores').select('*');
        if (filtroCidade) query = query.ilike('cidade', `%${filtroCidade}%`);
        
        const { data, error } = await query.order('is_premium', { ascending: false }).limit(20);
        
        if (error) {
            console.error("Erro Supabase Vitrine:", error.message);
            return;
        }

        const container = document.getElementById('vitrineGrid');
        if (!data || data.length === 0) {
            container.innerHTML = `<p style="grid-column:1/-1; text-align:center; opacity:0.5;">Nenhum profissional cadastrado nesta regi√£o ainda.</p>`;
            return;
        }

        container.innerHTML = data.map(p => `
            <div class="prestador-card">
                ${p.is_premium ? '<div class="badge-premium">DESTAQUE</div>' : ''}
                <div class="card-header">
                    <div class="avatar">${p.nome.charAt(0)}</div>
                    <div>
                        <h4 style="margin:0">${p.nome}</h4>
                        <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ <span style="font-size:10px; color:var(--text-muted);">(5.0)</span></div>
                    </div>
                </div>
                <div style="font-size:14px; font-weight:700; color:var(--brand-yellow);">${p.servico}</div>
                <p style="font-size:13px; color:var(--text-muted); margin:0;">${p.bio || 'Profissional qualificado atendendo na regi√£o.'}</p>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px; border-top:1px solid var(--border); padding-top:15px;">
                    <span style="font-size:12px; opacity:0.7;">üìç ${p.cidade}</span>
                    <button onclick="contatoWhatsApp('${p.whatsapp}')" class="btn-yellow" style="padding:8px 15px; font-size:12px; border:none; border-radius:10px; cursor:pointer; font-weight:800;">CONTATO</button>
                </div>
            </div>
        `).join('');

        // Adicionar markers no mapa
        data.forEach(p => {
            if (p.lat && p.lng) {
                L.marker([p.lat, p.lng], { icon: p.is_premium ? goldIcon : null }).addTo(map)
                    .bindPopup(`<b>${p.nome}</b><br>${p.servico}`);
            }
        });
    }

    async function carregarMural() {
        const { data, error } = await _supabase.from('pedidos_ajuda').select('*').eq('status', 'aberto').order('created_at', { ascending: false });
        
        if (error) {
            console.error("Erro Supabase Mural:", error.message);
            return;
        }

        const container = document.getElementById('muralGrid');
        if (!data || data.length === 0) {
            container.innerHTML = `<p style="grid-column:1/-1; text-align:center; opacity:0.5;">N√£o h√° pedidos em aberto no momento.</p>`;
            return;
        }

        container.innerHTML = data.map(ped => `
            <div class="job-card">
                <span style="font-size:10px; color:var(--brand-yellow); font-weight:800; text-transform:uppercase;">Necessidade Urgente</span>
                <h3>${ped.titulo_ajuda}</h3>
                <p>"${ped.descricao}"</p>
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <span style="font-size:12px; opacity:0.7;">üìç ${ped.cidade}</span>
                    <button onclick="contatoWhatsApp('${ped.cliente_whats}', 'Ol√°, vi seu pedido no Ajuda A√≠: ${ped.titulo_ajuda}')" class="btn-yellow" style="padding:10px 20px; font-size:13px; border:none; border-radius:12px; cursor:pointer; font-weight:800;">QUERO AJUDAR</button>
                </div>
            </div>
        `).join('');
    }

    // --- A√á√ïES DOS MODAIS ---
    async function registrarPrestador(e) {
        e.preventDefault();
        const btn = document.getElementById('btnSalvarPrestador');
        btn.innerText = "PROCESSANDO...";
        btn.disabled = true;

        const payload = {
            nome: document.getElementById('pres_nome').value,
            whatsapp: document.getElementById('pres_whatsapp').value,
            servico: document.getElementById('pres_servico').value,
            cidade: document.getElementById('pres_cidade').value,
            bio: document.getElementById('pres_bio').value,
            lat: userLat,
            lng: userLng,
            is_premium: false
        };

        const { error } = await _supabase.from('prestadores').insert([payload]);

        if (error) {
            alert("Erro ao cadastrar: " + error.message);
        } else {
            alert("Sucesso! Seu perfil j√° est√° ativo na vitrine.");
            closeModal('modalPrestador');
            carregarVitrine(currentCity);
        }
        btn.innerText = "CRIAR MEU PERFIL";
        btn.disabled = false;
    }

    async function postarPedido(e) {
        e.preventDefault();
        const btn = document.getElementById('btnPostarPedido');
        btn.innerText = "POSTANDO...";
        btn.disabled = true;

        const payload = {
            cliente_nome: document.getElementById('ped_nome').value,
            cliente_whats: document.getElementById('ped_whatsapp').value,
            titulo_ajuda: document.getElementById('ped_titulo').value,
            cidade: document.getElementById('ped_cidade').value,
            descricao: document.getElementById('ped_descricao').value,
            status: 'aberto'
        };

        const { error } = await _supabase.from('pedidos_ajuda').insert([payload]);

        if (error) {
            alert("Erro ao postar: " + error.message);
        } else {
            alert("Seu pedido foi publicado com sucesso no mural!");
            closeModal('modalPedido');
            carregarMural();
        }
        btn.innerText = "POSTAR NO MURAL";
        btn.disabled = false;
    }

    // --- FUN√á√ïES AUXILIARES ---
    function contatoWhatsApp(tel, msg = "Ol√°! Vi seu perfil no Ajuda A√≠ e gostaria de um or√ßamento.") {
        const limpo = tel.replace(/\D/g, "");
        window.open(`https://wa.me/55${limpo}?text=${encodeURIComponent(msg)}`, '_blank');
    }

    function toggleMenu() { document.getElementById('navActions').classList.toggle('active'); }
    function closeMenu() { document.getElementById('navActions').classList.remove('active'); }
    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    // M√°scara de Telefone
    document.querySelectorAll('.mask-whatsapp').forEach(input => {
        input.addEventListener('input', (e) => {
            let v = e.target.value.replace(/\D/g, "");
            if (v.length > 11) v = v.slice(0, 11);
            if (v.length > 2) v = `(${v.slice(0, 2)}) ${v.slice(2, 3)} ${v.slice(3)}`;
            if (v.length > 7) v = `(${v.slice(1, 3)}) ${v.slice(5, 6)} ${v.slice(6, 10)}-${v.slice(10)}`;
            e.target.value = v;
        });
    });

    // Filtro de Busca Simples no Mural
    document.getElementById('muralSearch').addEventListener('input', (e) => {
        const termo = e.target.value.toLowerCase();
        document.querySelectorAll('.job-card').forEach(card => {
            card.style.display = card.innerText.toLowerCase().includes(termo) ? 'block' : 'none';
        });
    });

    // Inicializa√ß√£o ao carregar
    window.onload = () => {
        carregarVitrine();
        carregarMural();
        // Tenta pegar localiza√ß√£o inicial suavemente
        setTimeout(getGPS, 1000);
    };
</script>

</body>
</html>